<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dapla-manual – altinn3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/dapla-favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Ingen resultater",
    "search-matching-documents-text": "treff",
    "search-copy-link-title": "Kopier link til søk",
    "search-hide-matches-text": "Skjul flere treff",
    "search-more-match-text": "flere treff i dokumentet",
    "search-more-matches-text": "flere treff i dokumentet",
    "search-clear-button-title": "Nullstill",
    "search-detached-cancel-button-title": "Avbryt",
    "search-submit-button-title": "Send",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/dapla-long.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Dapla-manual</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://start.dapla.ssb.no/" rel="" target=""><i class="bi bi-people-fill" role="img" aria-label="Opprette Dapla-team">
</i> 
 <span class="menu-text">Opprette Dapla-team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://web.yammer.com/main/org/ssb.no/groups/eyJfdHlwZSI6Ikdyb3VwIiwiaWQiOiI5MDUzMjA2In0/all" rel="" target=""><i class="bi bi-question-lg" role="img">
</i> 
 <span class="menu-text">Stille spørsmål</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://ssb.pureservice.com/#/new/7" rel="" target=""><i class="bi bi-send-fill" role="img" aria-label="Åpne en sak hos Kundeservice">
</i> 
 <span class="menu-text">Melde sak</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/statisticsnorway/dapla-manual" rel="" target=""><i class="bi bi-github" role="img" aria-label="Dapla-manual GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./annet.html">Annet</a></li><li class="breadcrumb-item"><a href="./altinn3.html">Altinn 3</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Velkommen</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forord</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./introduksjon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduksjon</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hva-er-dapla.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hva er Dapla?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./innlogging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Innlogging</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./statistikkproduksjon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistikkproduksjon</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dapla-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dapla Team</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hva-er-dapla-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hva er Dapla-team?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./administrasjon-av-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Administrasjon av team</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gcc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Google Cloud Console</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overføring-av-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overføring av data</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./produksjonsløp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Produksjonsløp</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jobbe-med-kode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jobbe med kode</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./jobbe-med-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jobbe med data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hva-er-botter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hva er bøtter?</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./standarder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standarder</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datatilstander.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datatilstander</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./navnestandard-datalagring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Navnestandard datalagring</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./versjonering-av-datasett.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Versjonering av datasett</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./kildedata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kildedata</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./automatisering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatisering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./automatisering-avansert.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatisering Avansert</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./statistikkbanken.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistikkbanken</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualisering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualisering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dashboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dash og dashboard</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./annet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Annet</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git-og-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Git og Github</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datadoc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DataDoc</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./github-app-integrasjon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Koble prosjektet til Github</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gjenopprette-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gjenopprette data fra bøtter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pakke-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installere pakker</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./slette-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slette data fra bøtter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./altinn3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Altinn 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kartdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kartdata</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ordforklaringer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ordforklaringer</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Innhold</h2>
   
  <ul>
  <li><a href="#altinn-3" id="toc-altinn-3" class="nav-link active" data-scroll-target="#altinn-3">Altinn 3</a>
  <ul class="collapse">
  <li><a href="#forberedelse" id="toc-forberedelse" class="nav-link" data-scroll-target="#forberedelse">Forberedelse</a></li>
  <li><a href="#transfer-service" id="toc-transfer-service" class="nav-link" data-scroll-target="#transfer-service">Transfer Service</a></li>
  <li><a href="#automatiseringstjeneste-for-kildedata" id="toc-automatiseringstjeneste-for-kildedata" class="nav-link" data-scroll-target="#automatiseringstjeneste-for-kildedata">Automatiseringstjeneste for kildedata</a></li>
  <li><a href="#tips-og-triks" id="toc-tips-og-triks" class="nav-link" data-scroll-target="#tips-og-triks">Tips og triks</a>
  <ul class="collapse">
  <li><a href="#liste-ut-innhold-i-en-mappe" id="toc-liste-ut-innhold-i-en-mappe" class="nav-link" data-scroll-target="#liste-ut-innhold-i-en-mappe">Liste ut innhold i en mappe</a></li>
  <li><a href="#printe-xml-i-jupyter" id="toc-printe-xml-i-jupyter" class="nav-link" data-scroll-target="#printe-xml-i-jupyter">Printe XML i Jupyter</a></li>
  <li><a href="#fra-xml-til-pandas-dataframe" id="toc-fra-xml-til-pandas-dataframe" class="nav-link" data-scroll-target="#fra-xml-til-pandas-dataframe">Fra XML til Pandas DataFrame</a></li>
  <li><a href="#kopiere-filer-manuelt" id="toc-kopiere-filer-manuelt" class="nav-link" data-scroll-target="#kopiere-filer-manuelt">Kopiere filer manuelt</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="altinn-3" class="level1">
<h1>Altinn 3</h1>
<p><img src="images/altinn_logo.png" class="img-fluid" style="max-width: 50%; float: right;" alt="Dapla logo"></p>
<p>Frem mot sommeren 2025 skal alle skjema-undersøkelser i SSB som gjennomføres på <strong>Altinn 2</strong> flyttes over til <a href="https://docs.altinn.studio/nb/community/about/">Altinn 3</a>. Skjemaer som flyttes til Altinn 3 vil motta sine data på <strong>Dapla</strong>, og ikke på <em>bakken</em> som tidligere. Datafangsten håndteres av <a href="https://statistics-norway.atlassian.net/wiki/spaces/CUL/pages/2805530625/Teamsider">Team SUV</a>, mens statistikkseksjonene henter sine data fra Team SUV sitt lagringsområde på Dapla. I dette kapitlet beskriver vi nærmere hvordan statistikkseksjonene kan jobbe med Altinn3-data på Dapla. Kort oppsummert består det av disse stegene:</p>
<ol type="1">
<li>Statistikkprodusenten avtaler overføring av skjema fra <strong>Altinn 2</strong> til <strong>Altinn 3</strong> med planleggere på S821, som koordinerer denne jobben.</li>
<li>Når statistikkprodusentene får beskjed om at Altinn3-skjemaet skal sendes ut til oppgavegiverne, så må de opprette et <a href="./opprette-dapla-team.html">Dapla-team</a>.</li>
<li>Når Dapla-teamet er opprettet, og første skjema er sendt inn, så ber de Team SUV om å gi statistikkteamet tilgang til dataene som har kommet inn fra Altinn 3. I tillegg ber de om at Team SUV gir tilgang til teamets <em>Transfer Service</em> instans. <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Merk at det må gis separate tilganger for data i staging- og produksjonsmiljø.</li>
<li>Statistikkprodusenten setter opp en automatisk overføring av skjemadata med <a href="./overføring-av-data.html">Transfer Service</a>, fra Team SUV sitt lagringsområde over til Dapla-teamet sin kildebøtte.</li>
<li>Statistikkprodusentene kan begynne å jobbe med dataene i Dapla. Blant annet tilbyr Dapla en <strong>automatiseringstjeneste</strong> man kan bruke for å prosessere dataene fra kildedata til inndata<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</li>
</ol>
<p>Under forklarer vi mer med mer detaljer hvordan man går frem for gjennomføre steg 4-5 over.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ansvar for kildedata
</div>
</div>
<div class="callout-body-container callout-body">
<p>Selv om Team SUV tar ansvaret for datafangst fra Altinn3, så er det statistikkteamet som har ansvaret for langtidslagring av dataene i sin kildebøtte. Det vil si at at statistikkteamet må sørge for at data overføres til sin kildebøtte, og at de kan ikke regne med at Team SUV tar vare på en backup av dataene.</p>
</div>
</div>
<section id="forberedelse" class="level2">
<h2 class="anchored" data-anchor-id="forberedelse">Forberedelse</h2>
<p>Når skjema-dataene kommer inn fra Altinn 3 til Team SUV sitt lagringsområde, så er det en del ting som er verdt å tenke på:</p>
<ul>
<li><strong>Hvordan er filene organisert hos Team SUV?</strong><br>
Filstrukturen der Team SUV lagrer dataene som kommer inn fra Altinn 3, har en klar struktur. Du kan selv gå inn å kikke på dataene, enten <a href="./jobbe-med-data.html">fra Jupyter</a> eller <a href="./gcc.html">Google Cloud Console</a>, og bli bedre kjent med strukturen<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. <a href="#fig-altinn-path">Figur&nbsp;1</a> viser en hvordan en typisk filsti ser ut på lagringsområdet til Team SUV. Det starter med navnet til bøtta som Team SUV har opprettet for skjemaet. Deretter viser den innvitteringsdato, deretter et teknisk navn, og til slutt selve skjemanavnet.</li>
</ul>
<div id="fig-altinn-path" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/altinn_filsti.png" class="img-fluid figure-img" alt="Bilde av en typisk filsti som forklarer hva de ulike komponentene av stien betyr"></p>
<figcaption class="figure-caption">Figur&nbsp;1: Typisk filsti for et Altinn3-skjema.</figcaption>
</figure>
</div>
<ul>
<li><p><strong>Hvordan organisere dataene i din kildebøtte?</strong><br>
Når vi bruker Transfer Service til å synkronisere innholdet i Team SUV sitt lagringsområde til Dapla-teamet sitt lagringsområde, så er det mest hensiktmessig å fortsette å bruke mapppe-strukturen som Team SUV har. Grunnen er at vi ikke kan legge på noe logikk som lager en ny struktur. Tjenesten bare kopierer over data. Men du kan kan lage et nytt toppnivå-mappe som du ønsker at dataene skal synkroniseres til. F.eks. at alle Altinn-dataene legger seg inn i en mappe som heter <code>altinn</code>. Det er spesielt nyttig hvis du har flere datakilder som skal ligge i samme kildebøtte.</p></li>
<li><p><strong>Unike skjemanavn</strong><br>
Skjemanavnet du ser i <a href="#fig-altinn-path">Figur&nbsp;1</a> er unike. Dvs. at hvis en oppgavegiver sender inn flere skjemaer på samme dag, så er fortsatt skjemanavnet unikt. Det er viktig å være klar over når man bruker <a href="./automatisering.html">automatiseringstjenesten for kildedata</a> senere. Siden tjenesten trigges per fil, og man er avhengig av unike navn for å ikke skrive over filer, så er det nyttig å vite at man kan videreføre skjemanavnet i overgangen fra kildedata til inndata.</p></li>
</ul>
</section>
<section id="transfer-service" class="level2">
<h2 class="anchored" data-anchor-id="transfer-service">Transfer Service</h2>
<p>Når vi skal overføre filer fra Team SUV sin bøtte til vår kildebøtte, så kan vi gjøre det manuelt fra Jupyter <a href="./altinn3.html#kopiere-filer-manuelt">som forklart her.</a>. Men det er en bedre løsning å bruke en tjeneste som gjør dette for deg. <a href="./overføring-av-data.html">Transfer Service</a> er en tjeneste som kan brukes til å synkronisere innholdet mellom bøtter på Dapla, samt mellom bakke og sky. Når du skal ta i bruk tjenesten for å overføre data mellom en bøtte fra Team SUV sitt prosjekt <strong>altinn-data-prod</strong>, til en kildedata-bøtte i Dapla-teamet ditt, så gjør du følgende:</p>
<ol type="1">
<li>Følg denne beskrivelsen hvordan man <a href="./overføring-av-data.html#sette-opp-overføringsjobber">setter opp overføringsjobber</a>.</li>
<li>Etter at du har trykket på <code>Create Transfer Job</code> velger du <strong>Google Cloud Storage</strong> på begge alternativene under <strong>Get Started</strong>. Deretter går du videre ved å klikke på <strong>Next Step</strong>.</li>
<li>Under <strong>Choose a source</strong> så skal du velge hvor du skal kopiere data fra. Trykk på <strong>Browse</strong>. I vinduet som dukker opp trykker du på 🔻-ikonet ved siden av <strong>Project ID</strong>. I søkevinduet som dukker opp søker du opp <strong>altinn-data-prod</strong> og trykker på navnet. Da får du listet opp alle bøttene i altinn-data-prod prosjektet. Til slutt trykker du på bøtta som Team SUV har opprettet for undersøkelsen<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> og klikker <strong>Select</strong> til nederst på siden. Trykk deretter <strong>Next step</strong> for å gå videre.</li>
<li>Under <strong>Choose a destination</strong> så skal du velge hvor du skal kopiere data til. Dette steget er ganske likt som forrige, men du skal nå velge ditt eget projekt og kildebøtta der. Trykk på <strong>Browse</strong>. I vinduet som dukker opp trykker du på 🔻-ikonet ved siden av <strong>Project ID</strong>. I søkevinduet som dukker opp søker du opp <strong>prod-&lt;ditt teamnavn&gt;</strong> og trykker på navnet. Da får du listet opp alle bøttene i ditt team sitt prosjekt. Velg kildebøtta som har navnet <strong>ssb-prod-&lt;teamnavn&gt;-data-kilde</strong>. Hvis du ønsker å kopiere data til en undermappe i bøtta, så trykker du på <span style="color:red;"><strong>&gt;</strong></span>-ikonet ved bøttenavnet og velger ønsket undermappe<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>. Til slutt trykker du på <strong>Select</strong> til nederst på siden. Trykk deretter <strong>Next step</strong> for å gå videre.</li>
<li>Under <strong>Choose how and when to run job</strong> velger du <strong>Run with custom frequency</strong> og <strong>Starting now</strong> i <strong>Batch</strong>-modus. Hvis du ønsker å overføre så ofte som mulig, så velger du <strong>Custom frequency</strong> og <strong>Repeat every 1 Hours</strong>. Til slutt trykker du <strong>Next Step</strong> nederst på siden.</li>
<li>Under <strong>Choose Settings</strong> så legger du til en kort beskrivelse av jobben du har opprettet. Under de andre valgene kan du gjøre følgende:
<ul>
<li>Under <strong>Advanced transfer Options</strong> trenger du ikke gjøre noen endringer.</li>
<li>Under <strong>When to overwrite</strong> kan du velge <strong>If different</strong>.</li>
<li>Under <strong>When to delete</strong> kan du velge <strong>Never</strong>.</li>
<li>Under <strong>Manifest</strong> trenger du ikke huke av.</li>
<li>Under <strong>Logging options</strong> velger du samme som vist i <a href="#fig-ts-log">Figur&nbsp;2</a>.</li>
</ul></li>
</ol>
<div id="fig-ts-log" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/transfer-service-logging.png" class="img-fluid figure-img" alt="Bilde av en typisk filsti som forklarer hva de ulike komponentene av stien betyr"></p>
<figcaption class="figure-caption">Figur&nbsp;2: Valg av opsjoner for logging i Transfer Service</figcaption>
</figure>
</div>
<p>Til slutt trykker du <strong>Create</strong> for å aktivere tjenesten. Den vil da sjekke Team SUV sin bøtte hver time og kopiere over alle filer som ikke allerede eksisterer statistikkteamets kildebøtte.</p>
</section>
<section id="automatiseringstjeneste-for-kildedata" class="level2">
<h2 class="anchored" data-anchor-id="automatiseringstjeneste-for-kildedata">Automatiseringstjeneste for kildedata</h2>
<p>Når du har satt opp Transfer Service til å kopiere over filer fra Team SUV sin bøtte til statistikkteamets kildebøtte, så vil det potensielt komme inn nye skjemaer hver time. Disse kan du lese inn i <strong>Jupyter</strong> og jobbe med hvis du er kildedata-ansvarlig i teamet. Hvis du ikke er det så må du vente til dataene er tilgjengeliggjort i produkt-bøtta til teamet.</p>
<p>Siden få personer innehar rollen som kildedata-ansvarlig så er det laget en automatiseringstjeneste som kan bearbeide alle filer som kommer inn i kildebøtta. Den lar deg kjøre et python-script på alle filer som kommer inn i kildebøtta.</p>
<p><a href="./automatisering.html">Les mer om hvordan du kan bruker tjenesten her.</a></p>
</section>
<section id="tips-og-triks" class="level2">
<h2 class="anchored" data-anchor-id="tips-og-triks">Tips og triks</h2>
<p>I denne delen deles noen tips og triks for å jobbe med Altinn3-dataene på Dapla. Fokuset vil være på hvordan du kan lese inn og transformere xml-filer fra skjema-dataene.</p>
<section id="liste-ut-innhold-i-en-mappe" class="level3">
<h3 class="anchored" data-anchor-id="liste-ut-innhold-i-en-mappe">Liste ut innhold i en mappe</h3>
<p>For å se innholdet i en mappe gir det mest mening å bruke <a href="./gcc.html">Google Cloud Console</a>. Her kan du se både filer og mapper i et pek-og-klikk grensesnitt. Men du kan ikke se på innholdet i filene der. Til det må du bruke Jupyter.</p>
<p>Anta at vi ønsker å liste ut alle som leverte skjema den <strong>10. mars 2023</strong>. Da kan vi bruke <a href="https://gcsfs.readthedocs.io/en/latest/api.html">gcsfs</a> til å gjøre det<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dapla <span class="im">import</span> FileClient</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> FileClient.get_gcs_file_system()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Henter ut alle xml-filer under en filsti</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>xml_files <span class="op">=</span> fs.glob(<span class="st">"gs://ra0678-01-altinn-data-prod-e17d-ssb-altinn/2023/3/10/**.xml"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the list of parquet files</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>xml_files</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Her bruker vi <code>fs.glob()</code>-funksjonen fra <strong>gcsfs</strong> til å loope gjennom alle undermapper av <code>gs://ra0678-01-altinn-data-prod-e17d-ssb-altinn/2023/3/10/</code>, og legge alle filer som slutter med <code>.xml</code> til listen <code>xml_files</code>. Dermed har vi et Python-objekt som kun brukes til å hente inn de filene vi ønsker. Vi bruker da det vi vet om mappestrukturen i Team SUV sin bøtte som vi så tidligere i <a href="#fig-altinn-path">Figur&nbsp;1</a>.</p>
</section>
<section id="printe-xml-i-jupyter" class="level3">
<h3 class="anchored" data-anchor-id="printe-xml-i-jupyter">Printe XML i Jupyter</h3>
<p>Noen ganger kan det være nyttig å se en xml-fil direkte. Da kan vi lese den inn i Jupyter og printe den ut. Her er et eksempel på hvordan vi kan gjøre det, samtidig som vi formatterer den med <code>xml.dom.minidom</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xml.dom.minidom <span class="im">import</span> parseString</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dapla <span class="im">import</span> FileClient</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Kobler oss på bøttene</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> FileClient.get_gcs_file_system()</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Sett inn filstien din her</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="bu">file</span> <span class="op">=</span> <span class="st">"gs://ssb-prod-dapla-felles-data-delt/altinn3/form_dc551844cd74.xml"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>dom <span class="op">=</span> parseString(fs.cat_file(<span class="bu">file</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>pretty_xml <span class="op">=</span> dom.toprettyxml(indent<span class="op">=</span><span class="st">"  "</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(pretty_xml)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Vi brukte da <code>fs.cat_file()</code> til å hente inn innholdet i mappen, gjorde det om til xml-object, og formatterer outputen med <code>xml.dom.minidom</code>. Resultatet vil da se ut noe sånt som dette:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml code-with-copy"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">"1.0"</span> <span class="fu">?&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">melding</span><span class="ot"> xmlns:xsi=</span><span class="st">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="ot"> xmlns:xsd=</span><span class="st">"http://www.w3.org/2001/XMLSchema"</span><span class="ot"> dataFormatProvider=</span><span class="st">"SERES"</span><span class="ot"> dataFormatId=</span><span class="st">"7079"</span><span class="ot"> dataFormatVersion=</span><span class="st">"47315"</span>&gt;</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">InternInfo</span>&gt;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">raNummer</span>&gt;RA-XXXX&lt;/<span class="kw">raNummer</span>&gt;</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">skjemaVersjon</span>&gt;1.0&lt;/<span class="kw">skjemaVersjon</span>&gt;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">undersoekelsesNr</span>&gt;XXXXX&lt;/<span class="kw">undersoekelsesNr</span>&gt;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">visOppgaveByrde</span>&gt;0&lt;/<span class="kw">visOppgaveByrde</span>&gt;</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">visBrukeropplevelse</span>&gt;0&lt;/<span class="kw">visBrukeropplevelse</span>&gt;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">delregNr</span>&gt;2XXXXX&lt;/<span class="kw">delregNr</span>&gt;</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">periodeFritekst</span>&gt;3. kvartal 2022&lt;/<span class="kw">periodeFritekst</span>&gt;</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">periodeFomDato</span>&gt;2022-07-01&lt;/<span class="kw">periodeFomDato</span>&gt;</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">periodeTomDato</span>&gt;2022-09-30&lt;/<span class="kw">periodeTomDato</span>&gt;</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">periodeType</span>&gt;KVRT&lt;/<span class="kw">periodeType</span>&gt;</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">periodeNummer</span>&gt;3&lt;/<span class="kw">periodeNummer</span>&gt;</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">periodeAAr</span>&gt;2022&lt;/<span class="kw">periodeAAr</span>&gt;</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">periodeDato</span>&gt; &lt;/<span class="kw">periodeDato</span>&gt;</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">enhetsIdent</span>&gt;XXXXXX&lt;/<span class="kw">enhetsIdent</span>&gt;</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">enhetsType</span>&gt;BEDR&lt;/<span class="kw">enhetsType</span>&gt;</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">enhetsOrgNr</span>&gt;XXXXXXXXX&lt;/<span class="kw">enhetsOrgNr</span>&gt;</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">enhetsNavn</span>&gt;STATISTISK SENTRALBYRÅ &lt;/<span class="kw">enhetsNavn</span>&gt;</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">enhetsGateadresse</span>&gt;Akersveien 26&lt;/<span class="kw">enhetsGateadresse</span>&gt;</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">enhetsPostnr</span>&gt;0177&lt;/<span class="kw">enhetsPostnr</span>&gt;</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">enhetsPoststed</span>&gt;OSLO&lt;/<span class="kw">enhetsPoststed</span>&gt;</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">enhetsAvdeling</span>&gt;AVD XXXX&lt;/<span class="kw">enhetsAvdeling</span>&gt;</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">reporteeOrgNr</span>&gt;XXXXXXXXX&lt;/<span class="kw">reporteeOrgNr</span>&gt;</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">InternInfo</span>&gt;</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">Kontakt</span>&gt;</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">kontaktPersonNavn</span>&gt;OLA NORDMANN&lt;/<span class="kw">kontaktPersonNavn</span>&gt;</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">kontaktPersonEpost</span>&gt;ola@tull.no&lt;/<span class="kw">kontaktPersonEpost</span>&gt;</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">kontaktPersonTelefon</span>&gt; &lt;/<span class="kw">kontaktPersonTelefon</span>&gt;</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">kontaktInfoBekreftet</span>&gt;1&lt;/<span class="kw">kontaktInfoBekreftet</span>&gt;</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">kontaktInfoKommentar</span>&gt;Dette er en et eksempel for Dapla-manualen&lt;/<span class="kw">kontaktInfoKommentar</span>&gt;</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">Kontakt</span>&gt;</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  &lt;<span class="kw">Skjemadata</span>&gt;</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">ledigeStillinger</span>&gt;75&lt;/<span class="kw">ledigeStillinger</span>&gt;</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">datoPrefill</span>&gt; &lt;/<span class="kw">datoPrefill</span>&gt;</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  &lt;/<span class="kw">Skjemadata</span>&gt;</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">melding</span>&gt;</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fra-xml-til-pandas-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="fra-xml-til-pandas-dataframe">Fra XML til Pandas DataFrame</h3>
<p>De færreste ønsker å jobbe direkte med XML-filer. Derfor er det nyttig å kunne transformere XML-filene til et mer brukervennlig format, f.eks. en <strong>Pandas Dataframe</strong>. Her er et eksempel på hvordan vi kan gjøre det med Pandas:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dapla <span class="im">import</span> FileClient</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> single_xml_to_dataframe(file_path: <span class="bu">str</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    fs <span class="op">=</span> FileClient.get_gcs_file_system()</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> fs.<span class="bu">open</span>(file_path, mode<span class="op">=</span><span class="st">"r"</span>) <span class="im">as</span> f:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        single_xml <span class="op">=</span> f.read()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> ET.fromstring(single_xml)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    intern_info <span class="op">=</span> root.find(<span class="st">"InternInfo"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    kontakt <span class="op">=</span> root.find(<span class="st">"Kontakt"</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    skjemadata <span class="op">=</span> root.find(<span class="st">"Skjemadata"</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> []</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    all_tags <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> element <span class="kw">in</span> intern_info:</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        all_tags.add(element.tag)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> element <span class="kw">in</span> kontakt:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        all_tags.add(element.tag)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> element <span class="kw">in</span> skjemadata:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        all_tags.add(element.tag)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> tag <span class="kw">in</span> all_tags:</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        element <span class="op">=</span> intern_info.find(tag)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> element <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            element <span class="op">=</span> kontakt.find(tag)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> element <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            element <span class="op">=</span> skjemadata.find(tag)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> element <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            value <span class="op">=</span> element.text</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            data.append(value)</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            data.append(<span class="va">None</span>)</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Include the full path to the XML file in the data list</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    data.append(file_path)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the DataFrame inside the function</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame([data], columns<span class="op">=</span><span class="bu">list</span>(all_tags) <span class="op">+</span> [<span class="st">"pathToXmlFile"</span>])</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    path_to_xml_file_split <span class="op">=</span> df[<span class="st">"pathToXmlFile"</span>].<span class="bu">str</span>.split(<span class="st">"/"</span>)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the function</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">"gs://ra0678-01-altinn-data-prod-e17d-ssb-altinn/2023/3/24/28c34dce4232_e7bed8a4-def5-42dc-b1e2-b9fc66beb769/form_28c34dce4232.xml"</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> single_xml_to_dataframe(file_path<span class="op">=</span>file_path)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I funksjonen så søker vi etter alle elementer under taggene <code>intern_info</code>, <code>kontakt</code> og <code>skjemadata</code>. Dvs. at vi lager en dataframe med en rad, der vi tar med all data fra xml-filen. Til slutt legger vi til en kolonne med filstien til filen. Det kan være nyttig senere hvis man gå tilbake til xml-filen for å sjekke om konverteringen til en dataframe er riktig.</p>
<p>Funksjonen <code>single_xml_to_dataframe()</code> kan brukes til å loope over en liste med filstier (vi viste hvordan man lager en slik liste tidligere i kapitlet). Men et typisk problem som vil oppstå da er at xml-filene har forskjellig antall elementer i seg, som gir dataframes med ulikt antall kolonner, og derfor vil ikke Pandas vite hvordan man konkatinerer disse. For å fikse dette må du modifisere funksjonen til å ta høyde for dette.</p>
</section>
<section id="kopiere-filer-manuelt" class="level3">
<h3 class="anchored" data-anchor-id="kopiere-filer-manuelt">Kopiere filer manuelt</h3>
<p>Hvis vi ønsker å kopiere filer manuelt (dvs. ikke med Transfer Service) fra Team SUV sine bøtter til egen kildebøtte, kan vi gjøre det fra Jupyter. Vi har tidligere sett hvordan vi kan <a href="./jobbe-med-data.html#kopiere-filer">kopiere enkeltfiler</a> mellom to bøtter. Under viser vi hvordan man kan kopiere alle filer under en viss filsti med kommandoen <code>fs.copy()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dapla <span class="im">import</span> FileClient</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Setter opp en filsystem-instans mot GCS</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> FileClient.get_gcs_file_system()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>from_path <span class="op">=</span> <span class="st">"gs://ssb-prod-arbmark-skjema-data-kilde/ledstill/altinn/2022/11/21/"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>to_path <span class="op">=</span> <span class="st">"gs://ssb-prod-dapla-felles-data-delt/altinn3/"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>fs.copy(from_path, to_path, recursive<span class="op">=</span><span class="va">True</span>)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I koden over så kopierer vi alle filer under <code>from_path</code> til <code>to_path</code>. Vi bruker <code>recursive=True</code> for å sørge for at vi kopierer alle filer under <code>from_path</code>.</p>
<p>I eksempelet over så kopierer vi over alt som er <code>from_path</code> og dets undermapper. I tilfellet med Altinn-data så ligger det også pdf-filer av skjemaet som kanskje ikke ønsker å kopiere. I de tilfellene kan vi først søke etter de filene vi ønsker å kopiere og legge de i en liste. Deretter kan vi kopiere over en og en fil fra listen. Denne tilnærmingen er veldig nyttig hvis vi ønsker å filtrere ut filer som ikke er XML-filer, eller vi ønsker en annen mappestruktur en den som ligger i <code>from_path</code>. Her er en måte vi kan gjøre det på:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dapla <span class="im">import</span> FileClient</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lager en filsystem-instans av GCS</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> FileClient.get_gcs_file_system()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Henter ut alle xml-filer under en filsti</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>xml_files <span class="op">=</span> fs.glob(<span class="st">"gs://ra0678-01-altinn-data-prod-e17d-ssb-altinn/2023/3/10/**.xml"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Stien du ønsker å kopiere til.</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Koden under foutsetter at du har med gs:// først</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>to_folder <span class="op">=</span> <span class="st">"gs://ssb-prod-dapla-felles-data-delt/"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Kopierer over filene</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> xml_files:</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    from_bucket <span class="op">=</span> <span class="bu">file</span>.split(<span class="st">"/"</span>)[<span class="dv">0</span>]</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    to_bucket <span class="op">=</span> to_folder.split(<span class="st">"/"</span>)[<span class="dv">2</span>]</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    to_path <span class="op">=</span> <span class="bu">file</span>.replace(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        from_bucket, to_bucket</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    fs.cp(<span class="bu">file</span>, to_path)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I koden over så bruker vi <code>fs.glob()</code> og <code>**</code> til å søke rekursivt etter alle xml-filer under filstien <code>gs://ra0678-01-altinn-data-prod-e17d-ssb-altinn/2023/3/10</code>. Deretter kopierer vi over filene til egen kildebøtte med <code>fs.cp()</code>. Når vi skal kopiere over til en ny bøtte må vi bestemme oss for hvor filene skal ligge og hvor mye av den gamle filstien vi skal beholde. Anta at vi skal beholde hele mappestrukturen i Team SUV sin bøtte. Da kan vi egentlig bare erstatte <code>ra0678-01-altinn-data-prod-e17d-ssb-altinn/</code> med den nye bøtte-navnet, og vi vil få den samme strukturen som i Team SUV sin bøtte.</p>


</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Fotnoter</h2>

<ol>
<li id="fn1"><p>Forslag til e-post til Team SUV etter at teamet er opprettet:<br>
<em>Vi har opprettet et Dapla-tema som heter &lt;ditt teamnavn&gt; for å jobbe med skjema &lt;RA-XXXX&gt;. Kan dere gi oss tilgang til riktig lagringsområde og også gi vår Transfer Service lesetilgang.</em><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>En typisk prosessering som de fleste vil ønske å gjøre er å konvertere fra xml-formatet det kom på, og over til parquet-formatet.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Du kan gå inn i <a href="./gcc.html">Google Cloud Console</a> og søke opp prosjektet til Team SUV som de bruker for å dele data. Det heter <strong>altinn-data-prod</strong>, og du finner bøttene ved å klikke deg inn på <strong>Cloud Storage</strong><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Bøttenavnet starter alltid med RA-nummeret til undersøkelsen.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Alternativt oppretter du en mappe direkte vinduet ved å trykke på mappe-ikonet med en <strong>+</strong>-tegn i seg.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>For å jobbe mot datat i GCS som i et “vanlig” filsysten kan vi bruke <strong>FileClient.get_gcs_file_system()</strong> fra <strong>dapla-toolbelt</strong>.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Kom i gang med Dapla</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>