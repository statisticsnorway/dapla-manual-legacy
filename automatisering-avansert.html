<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dapla-manual – automatisering-avansert</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/dapla-favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Ingen resultater",
    "search-matching-documents-text": "treff",
    "search-copy-link-title": "Kopier link til søk",
    "search-hide-matches-text": "Skjul flere treff",
    "search-more-match-text": "flere treff i dokumentet",
    "search-more-matches-text": "flere treff i dokumentet",
    "search-clear-button-title": "Nullstill",
    "search-detached-cancel-button-title": "Avbryt",
    "search-submit-button-title": "Send",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/dapla-long.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Dapla-manual</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://start.dapla.ssb.no/" rel="" target=""><i class="bi bi-people-fill" role="img" aria-label="Opprette Dapla-team">
</i> 
 <span class="menu-text">Opprette Dapla-team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://web.yammer.com/main/org/ssb.no/groups/eyJfdHlwZSI6Ikdyb3VwIiwiaWQiOiI5MDUzMjA2In0/all" rel="" target=""><i class="bi bi-question-lg" role="img">
</i> 
 <span class="menu-text">Stille spørsmål</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://ssb.pureservice.com/#/new/7" rel="" target=""><i class="bi bi-send-fill" role="img" aria-label="Åpne en sak hos Kundeservice">
</i> 
 <span class="menu-text">Melde sak</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/statisticsnorway/dapla-manual" rel="" target=""><i class="bi bi-github" role="img" aria-label="Dapla-manual GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./statistikkproduksjon.html">Statistikkproduksjon</a></li><li class="breadcrumb-item"><a href="./produksjonsløp.html">Produksjonsløp</a></li><li class="breadcrumb-item"><a href="./kildedata.html">Kildedata</a></li><li class="breadcrumb-item"><a href="./automatisering-avansert.html">Automatisering Avansert</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Velkommen</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forord</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./introduksjon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduksjon</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hva-er-dapla.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hva er Dapla?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./innlogging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Innlogging</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./statistikkproduksjon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistikkproduksjon</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dapla-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dapla Team</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hva-er-dapla-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hva er Dapla-team?</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./administrasjon-av-team.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Administrasjon av team</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gcc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Google Cloud Console</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overføring-av-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overføring av data</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./produksjonsløp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Produksjonsløp</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jobbe-med-kode.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jobbe med kode</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jobbe-med-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jobbe med data</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./standarder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standarder</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datatilstander.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datatilstander</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./navnestandard-datalagring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Navnestandard datalagring</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./versjonering-av-datasett.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Versjonering av datasett</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./kildedata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kildedata</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth3 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./automatisering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatisering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./automatisering-avansert.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Automatisering Avansert</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./statistikkbanken.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistikkbanken</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./visualisering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Visualisering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dashboard.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dash og dashboard</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./annet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Annet</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git-og-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Git og Github</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datadoc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DataDoc</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./github-app-integrasjon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Koble prosjektet til Github</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gjenopprette-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gjenopprette data fra bøtter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pakke-install.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Installere pakker</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./slette-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slette data fra bøtter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./altinn3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Altinn 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kartdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kartdata</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ordforklaringer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ordforklaringer</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Innhold</h2>
   
  <ul>
  <li><a href="#automatisering-avansert" id="toc-automatisering-avansert" class="nav-link active" data-scroll-target="#automatisering-avansert">Automatisering Avansert</a>
  <ul class="collapse">
  <li><a href="#infrastruktur-oversikt" id="toc-infrastruktur-oversikt" class="nav-link" data-scroll-target="#infrastruktur-oversikt">Infrastruktur oversikt</a></li>
  <li><a href="#ressurser" id="toc-ressurser" class="nav-link" data-scroll-target="#ressurser">Ressurser</a></li>
  <li><a href="#tilgjengelige-pakker" id="toc-tilgjengelige-pakker" class="nav-link" data-scroll-target="#tilgjengelige-pakker">Tilgjengelige pakker</a></li>
  <li><a href="#skalering" id="toc-skalering" class="nav-link" data-scroll-target="#skalering">Skalering</a></li>
  <li><a href="#testing-i-staging-miljø" id="toc-testing-i-staging-miljø" class="nav-link" data-scroll-target="#testing-i-staging-miljø">Testing i staging-miljø</a></li>
  <li><a href="#validering" id="toc-validering" class="nav-link" data-scroll-target="#validering">Validering</a>
  <ul class="collapse">
  <li><a href="#validerings-logger" id="toc-validerings-logger" class="nav-link" data-scroll-target="#validerings-logger">Validerings logger</a></li>
  </ul></li>
  <li><a href="#utrulling" id="toc-utrulling" class="nav-link" data-scroll-target="#utrulling">Utrulling</a>
  <ul class="collapse">
  <li><a href="#bekrefte-utrulling" id="toc-bekrefte-utrulling" class="nav-link" data-scroll-target="#bekrefte-utrulling">Bekrefte utrulling</a></li>
  </ul></li>
  <li><a href="#monitorering-av-tjenesten" id="toc-monitorering-av-tjenesten" class="nav-link" data-scroll-target="#monitorering-av-tjenesten">Monitorering av tjenesten</a>
  <ul class="collapse">
  <li><a href="#logger" id="toc-logger" class="nav-link" data-scroll-target="#logger">Logger</a></li>
  <li><a href="#ubehandlede-filer" id="toc-ubehandlede-filer" class="nav-link" data-scroll-target="#ubehandlede-filer">Ubehandlede filer</a></li>
  </ul></li>
  <li><a href="#trigge-tjenesten-manuelt" id="toc-trigge-tjenesten-manuelt" class="nav-link" data-scroll-target="#trigge-tjenesten-manuelt">Trigge tjenesten manuelt</a>
  <ul class="collapse">
  <li><a href="#eksempel" id="toc-eksempel" class="nav-link" data-scroll-target="#eksempel">Eksempel</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="automatisering-avansert" class="level1">
<h1>Automatisering Avansert</h1>
<section id="infrastruktur-oversikt" class="level2">
<h2 class="anchored" data-anchor-id="infrastruktur-oversikt">Infrastruktur oversikt</h2>
<div id="fig-infrastruktur" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dapla-cloud-run-processor-example.png" class="img-fluid figure-img" style="width:100.0%" alt="Infrastruktur oversikt diagram"></p>
<figcaption class="figure-caption">Figur&nbsp;1: Infrastruktur</figcaption>
</figure>
</div>
</section>
<section id="ressurser" class="level2">
<h2 class="anchored" data-anchor-id="ressurser">Ressurser</h2>
<p>Som utgangspunkt, får hver prosesseringsinstans standard ressurstildeling for Cloud Run, dvs. 1 CPU kjerne og 512MB minne. Dette kan være for lite i noen tilfeller, særlig for større kildedatafiler. Hvis det oppleves at mer minne kreves, ta gjerne kontakt med <a href="https://ssb.pureservice.com/#/new/7">Dapla Kundeservice</a> for å ordne dette.</p>
</section>
<section id="tilgjengelige-pakker" class="level2">
<h2 class="anchored" data-anchor-id="tilgjengelige-pakker">Tilgjengelige pakker</h2>
<p>En liste over Python pakker man kan benytte seg av i <code>process_source_data.py</code> finnes <a href="https://github.com/statisticsnorway/dapla-source-data-processor/blob/main/requirements.txt">her</a>. Ta gjerne kontakt med <a href="https://ssb.pureservice.com/#/new/7">Dapla Kundeservice</a> hvis man har behov for ytterligere.</p>
</section>
<section id="skalering" class="level2">
<h2 class="anchored" data-anchor-id="skalering">Skalering</h2>
<p>Hver kilde kan skalere opp med parallele prosesseringsinstanser. Det gjør det kjappere å prosessere mange filer. I utgangspunktet er dette begrenset til 5 parallele instanser, men det kan økes ved behov.</p>
</section>
<section id="testing-i-staging-miljø" class="level2">
<h2 class="anchored" data-anchor-id="testing-i-staging-miljø">Testing i staging-miljø</h2>
<p>Å benytte både prod og staging miljøer er en god praksis for å sikre at nye funksjoner og endringer fungerer som forventet før de rulles ut i produksjon. Staging-miljøet gir mulighet til å validere endringer i en mer kontrollert og isolert setting før de blir lansert i produksjonsmiljøet med skarpe data.</p>
<p>Automatiseringsløsningen støtter oppsett av kilder i både <code>staging</code> og <code>prod</code> miljø. For oppsett av kilder i <code>staging</code>-miljøet, må man legge til kilden i en egen undermappe kalt staging. Dette kan gjøres på samme måte som beskrevet <a href="./automatisering.html#skrive-prosesseringsscriptet">her</a>, bortsett fra at kilden legges i en undermappe som heter <code>staging</code>.</p>
<p>Her er et eksempel på konfigurasjon av både staging og produksjonsmiljø:</p>
<pre><code>...
├── automation
│&nbsp;&nbsp; └── source_data
│&nbsp;&nbsp;     ├── prod
│&nbsp;&nbsp;     │&nbsp;&nbsp; └── kilde1
│&nbsp;&nbsp;     │&nbsp;&nbsp;  &nbsp;&nbsp; ├── config.yaml
│&nbsp;&nbsp;     │&nbsp;&nbsp;  &nbsp;&nbsp; └── process_source_data.py
│&nbsp;&nbsp;     └── staging
│&nbsp;&nbsp;         └── kilde1
│&nbsp;&nbsp;             ├── config.yaml
│&nbsp;&nbsp;             └── process_source_data.py
...</code></pre>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Innholdet i config.yaml for både staging og produksjonsmiljø er som hovedregel identisk, men bøttene som benyttes vil være forskjellige. Stagingmiljøet har en egen kildedatabøtte kalt <code>gs://ssb-staging-my-project-data-kilde</code>.</p>
</div>
</div>
</div>
</section>
<section id="validering" class="level2">
<h2 class="anchored" data-anchor-id="validering">Validering</h2>
<p>For å gi raskt tilbakemelding på noen mulige feilsituasjoner, så kjøres det enkel validering på kilde config og <code>process_source_data.py</code> når en <a href="./ordforklaringer.html#pull-request-pr">PR</a> er opprettet.</p>
<p>Hvis valideringen feiler, så må feilen rettes før PRen merges.</p>
<p>Testene feiler hvis:</p>
<ol type="1">
<li>Kildemappen ikke har et python script kalt process_source_data.py med metodesignaturen, som beskrevet <a href="./automatisering.html#skrive-prosesseringsscriptet">her</a>.</li>
<li>Kildemappen ikke har en yaml fil og en gyldig folder_prefix definert, som i dette <a href="./automatisering.html#innhold-i-config.yaml-for-boller">eksempelet</a>.</li>
<li>Python scriptet ikke kan importeres av tjenesten. Tjenesten støtter kun <a href="#tilgjengelige-pakker">disse tredjeparts pakkene</a>.</li>
<li>Hvis <a href="./ordforklaringer.html#pyflakes">Pyflakes</a> finner feil med kildens Python script.</li>
</ol>
<section id="validerings-logger" class="level3">
<h3 class="anchored" data-anchor-id="validerings-logger">Validerings logger</h3>
<p>Hvis validerings testene feiler kan det være nyttig å se på loggene for å finne frem til feilen.</p>
<ol type="1">
<li>Finn frem til testen som feiler, i bildet feiler valideringstestene for kilde1. Trykk så på lenken “Details” som vist i bilde under. <img src="images/fail-pr-tests-log-step1.png" class="img-fluid" alt="GitHub test kilde1 feiler"></li>
<li>På siden du nå har kommet til skal det være en tabell som heter “Build Information”, trykk på lenken i Build kolonnen. <img src="images/fail-pr-tests-log-step2.png" class="img-fluid" alt="Build Information tabell"></li>
<li>Du har nå kommet frem til loggene, se etter indikasjoner på feil. I eksemplet under ser vi at testen test_main_accepts_expected_number_of_args feiler fordi <code>process_source_data.py</code> mangler en main funksjon. <img src="images/fail-pr-tests-log-step3.png" class="img-fluid" alt="Cloud Run logg"></li>
<li>Fiks feilen og push endingen til samme branch, testen vil da starte på nytt.</li>
</ol>
</section>
</section>
<section id="utrulling" class="level2">
<h2 class="anchored" data-anchor-id="utrulling">Utrulling</h2>
<p>Endringer til <code>process_source_data.py</code> blir automatisk rullet ut når en <a href="./ordforklaringer.html#pull-request-pr">PR</a> er merget til <code>main</code> branchen. Utrullingsprosessen tar noe tid, ca. 2-3 minutter fra branchen er merget til tjenesten er oppdatert, for å bekrefte at tjenesten er rullet ut kan du følge stegene i neste avsnitt.</p>
<section id="bekrefte-utrulling" class="level3">
<h3 class="anchored" data-anchor-id="bekrefte-utrulling">Bekrefte utrulling</h3>
<p>Stegene under viser hvordan man går frem for å finne resultat av utrullingen av kilden “ledstill” for teamet “arbmark-skjema”. Og forutsetter at koden er pushet til main branchen.</p>
<ol type="1">
<li>Naviger til <a href="https://github.com/">GitHub</a>.</li>
<li>I søkefeltet oppe i venstre hjørne skriv arbmark-skjema og klikk “Jump to” arbmark-skjema-iac. Som i bilde under. <img src="images/search-team-iac-repo.png" class="img-fluid" alt="Søk etter arbmark-skjema på GitHub"></li>
<li>Når utrullingen er ferdig vil en av disse ikonene vises, grønn hake betyr at tjeneste er rullet ut med koden som ligger i main og at nye filer blir behandlet med koden som ligger der. <img src="images/test-github-success.png" class="img-fluid" alt="Ikon: hake, bygg gikk bra">. Rødt kryss indikerer at utrullig har feilet. <img src="images/test-github-failure.png" class="img-fluid" alt="Ikon: bygg feilet"> <br>Se etter symbolene der hvor den røde pilen i bilde under peker. I eksempel er utrulligen vellykket. <img src="images/github-build-results1.png" class="img-fluid" alt="Sjekkmerke GitHub"></li>
</ol>
</section>
</section>
<section id="monitorering-av-tjenesten" class="level2">
<h2 class="anchored" data-anchor-id="monitorering-av-tjenesten">Monitorering av tjenesten</h2>
<p>Man får en oversikt over kildene man har konfigurert prosessering for og statusen på dem ved hjelp av konsollet på <a href="./ordforklaringer.html#google-cloud-platform-gcp">GCP</a>. Der navigerer man til siden for <code>Cloud Run</code> (se <a href="#fig-cloud-run-dashboard">Figur&nbsp;2</a>) som er kjøremiljøet som kildedata prosessering benyttes av. Eksempel URl er: <code>https://console.cloud.google.com/run?project=&lt;teamets-prosjekt-id&gt;</code></p>
<p>Her får man en oversikt av ressursbruk og loggene til prosesseringen.</p>
<div id="fig-cloud-run-dashboard" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/cloud-run-dashboard.png" class="img-fluid figure-img" style="width:100.0%" alt="Cloud Run dashboard"></p>
<figcaption class="figure-caption">Figur&nbsp;2: Cloud Run dashboard</figcaption>
</figure>
</div>
<section id="logger" class="level3">
<h3 class="anchored" data-anchor-id="logger">Logger</h3>
<p>Etter du har valgt kilden kan du se logger ved å velge fanen “LOGS”. Her ligger alle logger for den spesifikke kilden. For å få bedre oversikt over eventulle feil kan man sette severity til error. Dette vil uten ekstra konfigurasjon gi oversikt over alle uhåndterte exceptions. <img src="images/log-severity-error.png" class="img-fluid" alt="Sett log severity til error"></p>
</section>
<section id="ubehandlede-filer" class="level3">
<h3 class="anchored" data-anchor-id="ubehandlede-filer">Ubehandlede filer</h3>
<p>Hvis en fil blir mottatt av tjenesten, men ikke lar seg behandle blir det skrevet til loggen. Man kan få en oversik over hvilke filer som ikke har blitt prosessert ved å søke etter: <code>Could not process object</code>. <img src="images/cloud-run-dashboard-logs.png" id="fig-cloud-run-dashboard" class="img-fluid" style="width:100.0%" alt="Cloud Run logs"></p>
</section>
</section>
<section id="trigge-tjenesten-manuelt" class="level2">
<h2 class="anchored" data-anchor-id="trigge-tjenesten-manuelt">Trigge tjenesten manuelt</h2>
<p>Noen ganger vil det være nødvendig å trigge kjøring av en kilde uten at de tilhørende filene i kildebøtta er oppdatert f.eks. etter en endring i prosseseringsskriptet. For å gjøre dette kan man benytte seg av dapla toolbelt.</p>
<p>For å trigge en ny kjøring må man være data-admin i teamet og ha denne informasjonen tilgjengelig:</p>
<ol type="1">
<li>project_id(prosjekt id) for kilden, den finner man ved å følge beskrivelsen <a href="./gcc.html#velg-prosjekt">her</a>.</li>
<li>folder_prefix beskriver stien til filene som skal behandles og fungerer på samme måte som i <a href="./automatisering.html#innhold-i-config.yaml-for-boller">config.yaml</a></li>
<li>source_name finner man ved å se på navnet til mappen hvor kilden konfigureres, i eksempelet <a href="./automatisering.html#struktur-i-iac-repo">her</a> ser vi at team <code>smaabakst</code> har to kilder <code>boller</code> og <code>rundstykker</code>.</li>
</ol>
<section id="eksempel" class="level3">
<h3 class="anchored" data-anchor-id="eksempel">Eksempel</h3>
<p>Dette eksemplet viser hvordan man går frem for å manuelt trigge kilden <code>boller</code> for team <code>smaabakst</code>.</p>
<p>Team <code>smaabakst</code> ønsker å re-prosessere alle filer i kilden <code>boller</code>. Ved å bruke samme folder_prefix som i <code>config.yaml</code> vil alle filer som tilhører kilden bli prosessert på nytt.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dapla <span class="im">import</span> trigger_source_data_processing</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>project_id <span class="op">=</span> <span class="st">"prod-smaabakst-b69d"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>source_name <span class="op">=</span> <span class="st">"boller"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>folder_prefix <span class="op">=</span> <span class="st">"boller"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>trigger_source_data_processing(project_id, source_name, folder_prefix)</span></code><button title="Kopier til utklippstavle" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Kom i gang med Dapla</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>