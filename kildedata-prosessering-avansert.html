<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dapla-manual – kildedata-prosessering-avansert</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./images/dapla-favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "Ingen resultater",
    "search-matching-documents-text": "treff",
    "search-copy-link-title": "Kopier link til søk",
    "search-hide-matches-text": "Skjul flere treff",
    "search-more-match-text": "flere treff i dokumentet",
    "search-more-matches-text": "flere treff i dokumentet",
    "search-clear-button-title": "Nullstill",
    "search-detached-cancel-button-title": "Avbryt",
    "search-submit-button-title": "Send"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/dapla-long.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Dapla-manual</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://start.dapla.ssb.no/"><i class="bi bi-people-fill" role="img" aria-label="Opprette Dapla-team">
</i> 
 <span class="menu-text">Opprette Dapla-team</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://web.yammer.com/main/org/ssb.no/groups/eyJfdHlwZSI6Ikdyb3VwIiwiaWQiOiI5MDUzMjA2In0/all"><i class="bi bi-question-lg" role="img">
</i> 
 <span class="menu-text">Stille spørsmål</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://ssb.pureservice.com/#/new/7"><i class="bi bi-send-fill" role="img" aria-label="Åpne en sak hos Kundeservice">
</i> 
 <span class="menu-text">Melde sak</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/statisticsnorway/dapla-manual"><i class="bi bi-github" role="img" aria-label="Dapla-manual GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Velkommen</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">Forord</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./introduksjon.html" class="sidebar-item-text sidebar-link">Introduksjon</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hva-er-dapla.html" class="sidebar-item-text sidebar-link">Hva er Dapla?</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hvorfor-dapla.html" class="sidebar-item-text sidebar-link">Hvorfor Dapla?</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./arkitektur.html" class="sidebar-item-text sidebar-link">Arkitektur</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./innlogging.html" class="sidebar-item-text sidebar-link">Innlogging</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jupyterlab.html" class="sidebar-item-text sidebar-link">Jupyterlab</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bakke-sky.html" class="sidebar-item-text sidebar-link">Bakke vs.&nbsp;sky</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./dapla-team.html" class="sidebar-item-text sidebar-link">Opprette Dapla-team</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hva-er-dapla-team.html" class="sidebar-item-text sidebar-link">Hva er Dapla-team?</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./opprette-dapla-team.html" class="sidebar-item-text sidebar-link">Opprette Dapla-team</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bøtter.html" class="sidebar-item-text sidebar-link">Bøtter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gcc.html" class="sidebar-item-text sidebar-link">Google Cloud Console</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./overføre-data.html" class="sidebar-item-text sidebar-link">Overføre data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jobbe-med-data.html" class="sidebar-item-text sidebar-link">Jobbe med data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./slette-data.html" class="sidebar-item-text sidebar-link">Slette data fra bøtter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gjenopprette-data.html" class="sidebar-item-text sidebar-link">Gjenopprette data fra bøtter</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bakke-til-sky.html" class="sidebar-item-text sidebar-link">Fra bakke til sky</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./administrasjon.html" class="sidebar-item-text sidebar-link">Administrasjon av team</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./ssbproject.html" class="sidebar-item-text sidebar-link">SSB-project</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nytt-ssbproject.html" class="sidebar-item-text sidebar-link">Nytt ssb-project</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git-github.html" class="sidebar-item-text sidebar-link">Git og Github</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./virtual-env.html" class="sidebar-item-text sidebar-link">Virtuelle miljøer</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./jupyter-kernel.html" class="sidebar-item-text sidebar-link">Jupyter-kernels</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pakke-install.html" class="sidebar-item-text sidebar-link">Installere pakker</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pyspark-venv.html" class="sidebar-item-text sidebar-link">Bruk av pyspark i virtuelle miljøer</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./samarbeid.html" class="sidebar-item-text sidebar-link">Samarbeid</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vedlikehold.html" class="sidebar-item-text sidebar-link">Vedlikehold</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./data.html" class="sidebar-item-text sidebar-link">Data</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datatilstander.html" class="sidebar-item-text sidebar-link">Datatilstander</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./kildedata.html" class="sidebar-item-text sidebar-link">Kildedata</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kildedata-prosessering.html" class="sidebar-item-text sidebar-link">Kildedata prosessering</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./github-app-integrasjon.html" class="sidebar-item-text sidebar-link">Koble prosjektet til Github</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kildedata-prosessering-avansert.html" class="sidebar-item-text sidebar-link active">Avansert</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./jupyter-pa-bakken.html" class="sidebar-item-text sidebar-link">Jupyterlab på bakken</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pakke-install-bakken.html" class="sidebar-item-text sidebar-link">Installere pakker</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lese-data-bakken.html" class="sidebar-item-text sidebar-link">Lese inn filer</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./avansert.html" class="sidebar-item-text sidebar-link">Avansert</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lese-data.html" class="sidebar-item-text sidebar-link">Lese filer fra bøtte</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./remote.html" class="sidebar-item-text sidebar-link">IDE’er</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./schedulering.html" class="sidebar-item-text sidebar-link">Schedulering</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./databaser.html" class="sidebar-item-text sidebar-link">Databaser</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datadoc.html" class="sidebar-item-text sidebar-link">DataDoc</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ordforklaringer.html" class="sidebar-item-text sidebar-link">Ordforklaringer</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">Referanser</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Innhold</h2>
   
  <ul>
  <li><a href="#avansert" id="toc-avansert" class="nav-link active" data-scroll-target="#avansert">Avansert</a>
  <ul class="collapse">
  <li><a href="#infrastruktur-oversikt" id="toc-infrastruktur-oversikt" class="nav-link" data-scroll-target="#infrastruktur-oversikt">Infrastruktur oversikt</a></li>
  <li><a href="#ressurser" id="toc-ressurser" class="nav-link" data-scroll-target="#ressurser">Ressurser</a></li>
  <li><a href="#tilgjengelige-pakker" id="toc-tilgjengelige-pakker" class="nav-link" data-scroll-target="#tilgjengelige-pakker">Tilgjengelige pakker</a></li>
  <li><a href="#skalering" id="toc-skalering" class="nav-link" data-scroll-target="#skalering">Skalering</a></li>
  <li><a href="#validering" id="toc-validering" class="nav-link" data-scroll-target="#validering">Validering</a>
  <ul class="collapse">
  <li><a href="#validerings-logger" id="toc-validerings-logger" class="nav-link" data-scroll-target="#validerings-logger">Validerings logger</a></li>
  </ul></li>
  <li><a href="#utrulling" id="toc-utrulling" class="nav-link" data-scroll-target="#utrulling">Utrulling</a>
  <ul class="collapse">
  <li><a href="#bekrefte-utrulling" id="toc-bekrefte-utrulling" class="nav-link" data-scroll-target="#bekrefte-utrulling">Bekrefte utrulling</a></li>
  </ul></li>
  <li><a href="#monitorering-av-tjenesten" id="toc-monitorering-av-tjenesten" class="nav-link" data-scroll-target="#monitorering-av-tjenesten">Monitorering av tjenesten</a>
  <ul class="collapse">
  <li><a href="#logger" id="toc-logger" class="nav-link" data-scroll-target="#logger">Logger</a></li>
  <li><a href="#ubehandlede-filer" id="toc-ubehandlede-filer" class="nav-link" data-scroll-target="#ubehandlede-filer">Ubehandlede filer</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="avansert" class="level1">
<h1>Avansert</h1>
<section id="infrastruktur-oversikt" class="level2">
<h2 class="anchored" data-anchor-id="infrastruktur-oversikt">Infrastruktur oversikt</h2>
<div id="fig-infrastruktur" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/dapla-cloud-run-processor-example.png" class="img-fluid figure-img" style="width:100.0%" alt="Infrastruktur oversikt diagram"></p>
<p></p><figcaption class="figure-caption">Figur&nbsp;1: Infrastruktur</figcaption><p></p>
</figure>
</div>
</section>
<section id="ressurser" class="level2">
<h2 class="anchored" data-anchor-id="ressurser">Ressurser</h2>
<p>Som utgangspunkt, får hver prosesseringsinstans standard ressurstildeling for Cloud Run, dvs. 1 CPU kjerne og 512MB minne. Dette kan være for lite i noen tilfeller, særlig for større kildedatafiler. Hvis det oppleves at mer minne kreves, ta gjerne kontakt med <a href="https://ssb.pureservice.com/#/new/7">Dapla Kundeservice</a> for å ordne dette.</p>
</section>
<section id="tilgjengelige-pakker" class="level2">
<h2 class="anchored" data-anchor-id="tilgjengelige-pakker">Tilgjengelige pakker</h2>
<p>En liste over Python pakker man kan benytte seg av i <code>process_source_data.py</code> finnes <a href="https://github.com/statisticsnorway/dapla-source-data-processor/blob/main/requirements.txt">her</a>. Ta gjerne kontakt med <a href="https://ssb.pureservice.com/#/new/7">Dapla Kundeservice</a> hvis man har behov for ytterligere.</p>
</section>
<section id="skalering" class="level2">
<h2 class="anchored" data-anchor-id="skalering">Skalering</h2>
<p>Hver kilde kan skalere opp med parallele prosesseringsinstanser. Det gjør det kjappere å prosessere mange filer. I utgangspunktet er dette begrenset til 5 parallele instanser, men det kan økes ved behov.</p>
</section>
<section id="validering" class="level2">
<h2 class="anchored" data-anchor-id="validering">Validering</h2>
<p>For å gi raskt tilbakemelding på noen mulige feilsituasjoner, så kjøres det enkel validering på kilde config og <code>process_source_data.py</code> når en <a href="./ordforklaringer.html#pull-request-pr">PR</a> er opprettet.</p>
<p>Hvis valideringen feiler, så må feilen rettes før PRen merges.</p>
<p>Testene feiler hvis:</p>
<ol type="1">
<li>Kildemappen ikke har et python script kalt process_source_data.py med metodesignaturen, som beskrevet <a href="./kildedata-prosessering.html#skrive-prosesseringsscriptet">her</a>.</li>
<li>Kildemappen ikke har en yaml fil og en gyldig folder_prefix definert, som i dette <a href="./kildedata-prosessering.html#innhold-i-config.yaml-for-boller">eksempelet</a>.</li>
<li>Python scriptet ikke kan importeres av tjenesten. Tjenesten støtter kun <a href="#tilgjengelige-pakker">disse tredjeparts pakkene</a>.</li>
<li>Hvis <a href="./ordforklaringer.html#pyflakes">Pyflakes</a> finner feil med kildens Python script.</li>
</ol>
<section id="validerings-logger" class="level3">
<h3 class="anchored" data-anchor-id="validerings-logger">Validerings logger</h3>
<p>Hvis validerings testene feiler kan det være nyttig å se på loggene for å finne frem til feilen.</p>
<ol type="1">
<li>Finn frem til testen som feiler, i bildet feiler valideringstestene for kilde1. Trykk så på lenken “Details” som vist i bilde under. <img src="images/fail-pr-tests-log-step1.png" class="img-fluid" alt="GitHub test kilde1 feiler"></li>
<li>På siden du nå har kommet til skal det være en tabell som heter “Build Information”, trykk på lenken i Build kolonnen. <img src="images/fail-pr-tests-log-step2.png" class="img-fluid" alt="Build Information tabell"></li>
<li>Du har nå kommet frem til loggene, se etter indikasjoner på feil. I eksemplet under ser vi at testen test_main_accepts_expected_number_of_args feiler fordi <code>process_source_data.py</code> mangler en main funksjon. <img src="images/fail-pr-tests-log-step3.png" class="img-fluid" alt="Cloud Run logg"></li>
<li>Fiks feilen og push endingen til samme branch, testen vil da starte på nytt.</li>
</ol>
</section>
</section>
<section id="utrulling" class="level2">
<h2 class="anchored" data-anchor-id="utrulling">Utrulling</h2>
<p>Endringer til <code>process_source_data.py</code> blir automatisk rullet ut når en <a href="./ordforklaringer.html#pull-request-pr">PR</a> er merget til <code>main</code> branchen. Utrullingsprosessen tar noe tid, ca. 2-3 minutter fra branchen er merget til tjenesten er oppdatert, for å bekrefte at tjenesten er rullet ut kan du følge stegene i neste avsnitt.</p>
<section id="bekrefte-utrulling" class="level3">
<h3 class="anchored" data-anchor-id="bekrefte-utrulling">Bekrefte utrulling</h3>
<p>Stegene under viser hvordan man går frem for å finne resultat av utrullingen av kilden “ledstill” for teamet “arbmark-skjema”. Og forutsetter at koden er pushet til main branchen.</p>
<ol type="1">
<li>Naviger til <a href="https://github.com/">GitHub</a>.</li>
<li>I søkefeltet oppe i venstre hjørne skriv arbmark-skjema og klikk “Jump to” arbmark-skjema-iac. Som i bilde under. <img src="images/search-team-iac-repo.png" class="img-fluid" alt="Søk etter arbmark-skjema på GitHub"></li>
<li>Når utrullingen er ferdig vil en av disse ikonene vises, grønn hake betyr at tjeneste er rullet ut med koden som ligger i main og at nye filer blir behandlet med koden som ligger der. <img src="images/test-github-success.png" class="img-fluid" alt="Ikon: hake, bygg gikk bra">. Rødt kryss indikerer at utrullig har feilet. <img src="images/test-github-failure.png" class="img-fluid" alt="Ikon: bygg feilet"> <br>Se etter symbolene der hvor den røde pilen i bilde under peker. I eksempel er utrulligen vellykket. <img src="images/github-build-results1.png" class="img-fluid" alt="Sjekkmerke GitHub"></li>
</ol>
</section>
</section>
<section id="monitorering-av-tjenesten" class="level2">
<h2 class="anchored" data-anchor-id="monitorering-av-tjenesten">Monitorering av tjenesten</h2>
<p>Man får en oversikt over kildene man har konfigurert prosessering for og statusen på dem ved hjelp av konsollet på <a href="./ordforklaringer.html#google-cloud-platform-gcp">GCP</a>. Der navigerer man til siden for <code>Cloud Run</code> (se <a href="#fig-cloud-run-dashboard">Figur&nbsp;2</a>) som er kjøremiljøet som kildedata prosessering benyttes av. Eksempel URl er: <code>https://console.cloud.google.com/run?project=&lt;teamets-prosjekt-id&gt;</code></p>
<p>Her får man en oversikt av ressursbruk og loggene til prosesseringen.</p>
<div id="fig-cloud-run-dashboard" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/cloud-run-dashboard.png" class="img-fluid figure-img" style="width:100.0%" alt="Cloud Run dashboard"></p>
<p></p><figcaption class="figure-caption">Figur&nbsp;2: Cloud Run dashboard</figcaption><p></p>
</figure>
</div>
<section id="logger" class="level3">
<h3 class="anchored" data-anchor-id="logger">Logger</h3>
<p>Etter du har valgt kilden kan du se logger ved å velge fanen “LOGS”. Her ligger alle logger for den spesifikke kilden. For å få bedre oversikt over eventulle feil kan man sette severity til error. Dette vil uten ekstra konfigurasjon gi oversikt over alle uhåndterte exceptions. <img src="images/log-severity-error.png" class="img-fluid" alt="Sett log severity til error"></p>
</section>
<section id="ubehandlede-filer" class="level3">
<h3 class="anchored" data-anchor-id="ubehandlede-filer">Ubehandlede filer</h3>
<p>Hvis en fil blir mottatt av tjenesten, men ikke lar seg behandle blir det skrevet til loggen. Man kan få en oversik over hvilke filer som ikke har blitt prosessert ved å søke etter: <code>Could not process object</code>. <img src="images/cloud-run-dashboard-logs.png" id="fig-cloud-run-dashboard" class="img-fluid" style="width:100.0%" alt="Cloud Run logs"></p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Kom i gang med Dapla</div>
  </div>
</footer>



</body></html>